<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

    <head th:replace="~{fragments/commons :: head('Edit Profile')}"></head>

    <body>

        <div th:replace="~{fragments/commons :: header}"></div>

        <section class="edit-profile-section">
            <div class="container">
                <div class="edit-profile-card">

                    <div th:if="${errorMessage}" class="alert danger">
                        <p th:text="${errorMessage}"></p>
                    </div>

                    <h1>Edit Profile</h1>

                    <div class="profile-avatar">
                        <img id="avatarPreview"
                             th:src="${user.profileImageUrl != null && !user.profileImageUrl.isEmpty()
                               ? user.profileImageUrl
                               : 'https://static.vecteezy.com/system/resources/previews/048/926/061/non_2x/bronze-membership-icon-default-avatar-profile-icon-membership-icon-social-media-user-image-illustration-vector.jpg'}"
                             alt="Avatar Preview">
                    </div>

                    <div style="color: black; margin-bottom: 2rem">
                        <div >
                            <strong>User id: </strong>
                            <span th:text="${user.id}"></span>
                        </div>
                        <div>
                            <strong>Last profile update: </strong>
                            <span th:text="${#temporals.format(user.updatedAt, 'dd MMM yyyy â€¢ HH:mm')}"></span>
                        </div>
                    </div>

                    <form th:action="@{/profile}" th:object="${user}" th:method="put" class="edit-profile-form">

                        <input type="hidden" th:field="*{id}"/>
                        <input type="hidden" th:field="*{username}"/>

                        <div class="form-group">
                            <label for="email"><strong>Email</strong></label>
                            <input type="text" id="email" th:field="*{email}" class="form-control" placeholder="Enter your email address">
                            <p class="alert-warning" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></p>
                            <small class="error-message" th:text="${duplicateEmail}"></small>
                        </div>

                        <div class="form-group">
                            <label for="firstName"><strong>First Name</strong></label>
                            <input type="text" id="firstName" th:field="*{firstName}" class="form-control" placeholder="Enter your first name">
                            <p class="alert-warning" th:if="${#fields.hasErrors('firstName')}" th:errors="*{firstName}"></p>
                        </div>

                        <div class="form-group">
                            <label for="lastName"><strong>Last Name</strong></label>
                            <input type="text" id="lastName" th:field="*{lastName}" class="form-control" placeholder="Enter your last name">
                            <p class="alert-warning" th:if="${#fields.hasErrors('lastName')}" th:errors="*{lastName}"></p>
                        </div>

                        <div class="form-group">
                            <label for="phoneNumber"><strong>Phone Number</strong></label>
                            <input type="text" id="phoneNumber" th:field="*{phoneNumber}" class="form-control" placeholder="08xxxxxxxx">
                            <p class="alert-warning" th:if="${#fields.hasErrors('phoneNumber')}" th:errors="*{phoneNumber}"></p>
                        </div>

                        <div class="form-group">
                            <label for="profileImageUrl"><strong>Profile Image URL</strong></label>
                            <input type="text" id="profileImageUrl" th:field="*{profileImageUrl}" class="form-control"
                                   placeholder="Paste image URL"
                                   oninput="updateAvatarPreview(this.value)">
                            <p class="alert-warning" th:if="${#fields.hasErrors('profileImageUrl')}" th:errors="*{profileImageUrl}"></p>
                        </div>

                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                        <div class="form-actions">
                            <a th:href="@{/profile}" class="btn btn-secondary">Cancel</a>
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                        </div>

                    </form>
                </div>
            </div>
        </section>

        <script>
            function updateAvatarPreview(url) {
                const img = document.getElementById("avatarPreview");
                img.src = url && url.trim() !== "" ? url :
                    "https://static.vecteezy.com/system/resources/previews/048/926/061/non_2x/bronze-membership-icon-default-avatar-profile-icon-membership-icon-social-media-user-image-illustration-vector.jpg";
            }
        </script>

        <footer th:replace="~{fragments/commons :: footer}"></footer>

    </body>
</html>