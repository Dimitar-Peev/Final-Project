<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

    <head th:replace="~{fragments/commons :: head(#{page_title_events})}"></head>

    <body>

        <div th:replace="~{fragments/commons :: header}"></div>

        <section class="page-header">
            <div class="container">
                <h1 th:text="#{events_header_title}">All Events</h1>
                <p th:text="#{events_header_subtitle}">Browse and discover events happening around you</p>
            </div>
        </section>

        <section class="search-section">
            <div class="search-container">
                <div class="search-box">
                    <form class="search-form" th:action="@{/events/search}" th:method="get">
                        <div class="form-group">
                            <label for="keyword" th:text="#{events_search_keyword}">Event Name</label>
                            <input type="text" id="keyword" name="keyword" th:value="${param.keyword}" th:placeholder="#{events_search_keyword_placeholder}">
                        </div>
                        <div class="form-group">
                            <label for="city" th:text="#{events_search_city}">City</label>
                            <input type="text" id="city" name="city" th:value="${param.city}" th:placeholder="#{events_search_city_placeholder}">
                        </div>
                        <div class="form-group">
                            <label for="categoryId" th:text="#{events_search_category}">Category</label>
                            <select id="categoryId" name="categoryId">
                                <option value="" th:text="#{events_search_allCategories}">All Categories</option>
                                <option th:each="category : ${categories}"
                                        th:value="${category.id}"
                                        th:text="${category.name}"
                                        th:selected="${param.categoryId == category.id}">
                                </option>
                            </select>
                        </div>

                        <button type="submit" class="search-btn" th:text="#{events_search_button}">Search</button>
                    </form>
                </div>
            </div>
        </section>

        <section class="events-section">
            <div class="container">
                <div class="section-header">
                    <h2 th:text="#{events_section_title}">Events</h2>
                    <p th:text="#{events_section_subtitle}">Find events that match your interests</p>
                </div>

                <div class="events-grid" th:if="${events != null and !events.isEmpty()}">
                    <a th:each="event : ${events}"
                       th:href="@{/events/{id}(id=${event.id})}"
                       class="event-card">
                        <!-- Event content stays the same; badge and price can be i18n too if needed -->
                        <div class="event-image">
                            <span th:switch="${event.category.name.toLowerCase()}">
                                <span th:case="'music'">ğŸµ</span>
                                <span th:case="'technology'">ğŸ’»</span>
                                <span th:case="'business'">ğŸ’¼</span>
                                <span th:case="'sports'">ğŸƒ</span>
                                <span th:case="'art'">ğŸ¨</span>
                                <span th:case="'food'">ğŸ·</span>
                                <span th:case="'education'">ğŸ“š</span>
                                <span th:case="'cars'">ğŸš—</span>
                                <span th:case="*" th:text="${#strings.substring(event.title, 0, 1)}"></span>
                            </span>
                            <span class="event-badge" th:if="${event.availableTickets < event.maxCapacity * 0.3} and ${event.availableTickets > 0}">
                                Hot!
                            </span>
                            <span class="event-badge" th:if="${event.availableTickets == 0}">
                                Sold Out
                            </span>
                        </div>
                        <div class="event-content">
                            <div class="event-date"
                                 th:text="${#temporals.format(event.startDate, 'dd MMM yyyy â€¢ HH:mm')}"></div>
                            <h3 class="event-title" th:text="${event.title}"></h3>
                            <div class="event-location">ğŸ“
                                <span th:text="${event.venue.name + ', ' + event.venue.getCity()}"></span>
                            </div>
                            <div class="event-price">
                                <span th:if="${event.ticketPrice == 0}">Free</span>
                                <span th:unless="${event.ticketPrice == 0}"
                                      th:text="'From ' + ${#numbers.formatDecimal(event.ticketPrice, 1, 2) + ' BGN / '
                                      + #numbers.formatDecimal(event.ticketPrice / 1.95583, 1, 2) + ' EUR'}">
                                      50.00 BGN / 25.56 EUR
                                </span>
                            </div>
                        </div>
                    </a>
                </div>

                <div class="no-events" th:if="${events == null or events.isEmpty()}">
                    <h3 th:text="#{events_noEvents_title}">No events found</h3>
                    <p th:text="#{events_noEvents_subtitle}">Try adjusting your search filters or check back later.</p>
                    <a th:href="@{/events/new}" class="btn btn-primary"
                       sec:authorize="hasAnyRole('EVENT_ORGANIZER','ADMIN')"
                       th:text="#{events_noEvents_create}">Create Event</a>
                </div>
            </div>
        </section>

        <footer th:replace="~{fragments/commons :: footer}"></footer>

    </body>
</html>
